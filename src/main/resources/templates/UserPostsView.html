<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">

    <title>All Posts</title>

    <!-- CSS FILES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Open+Sans&display=swap"
          rel="stylesheet">

    <link href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet">

    <link href="../static/css/bootstrap-icons.css" th:href="@{/css/bootstrap-icons.css}" rel="stylesheet">

    <link href="../static/css/templatemo-topic-listing.css" th:href="@{/css/templatemo-topic-listing.css}"
          rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <link href="../static/css/home-page.css" th:href="@{/css/home-page.css}"
          rel="stylesheet">

    <div th:replace="~{fragments/ForumSystemForm :: navbar}"></div>
    <!--

    TemplateMo 590 topic listing

    https://templatemo.com/tm-590-topic-listing

    -->

    <style>
        h2.mb-4 {
            color: #13547a;
        }

        .d-inline-flex {
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .list-inline-item {
            margin-right: 10px;
        }

        .tags-container i,
        .tags-container p {
            display: inline-block;
            vertical-align: middle;
            margin-right: 5px;
        }

        #pagination a {
            padding: 5px 10px;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-decoration: none;
            color: #666;
            transition: background-color 0.3s, color 0.3s;
        }

        #pagination a:hover,
        #pagination a.current-page {
            background-color: #80d0c7;
            color: #ffffff;
            border-color: #80d0c7;
        }

        .post-filter {
            max-width: 100%;
            margin: auto;
            padding: 20px;
        }

        .form-label {
            margin-right: 10px;
        }

        .d-flex > * {
            margin: 0 5px;
        }

        .input-group-text {
            background-color: #e9ecef;
        }
        .form-control, .form-select {
            max-width: 160px;
        }

        .search:hover{
            background-color: #57c1b7;
        }

    </style>
</head>

<body class="topics-listing-page" id="top">
<main>
    <section class="section-padding">
        <div class="container">
            <div class="row">

                <div class="col-lg-12 col-12 text-center">
                    <h2 class="mb-4" th:text="|${username}'s posts|">User Posts</h2>
                </div>

                <div class="col-lg-8 col-12 mt-3 mx-auto">
                    <div id="postsContainer">
                        <div class="post" th:each="post : ${userPosts}">
                            <div class="custom-block custom-block-topics-listing bg-white shadow-lg mb-5">
                                <div class="d-flex">
                                    <div class="col-12">
                                        <h3 class="h4 mb-3">
                                            <a class="post-title" href="#" th:href="@{/posts/{id}(id=${post.postId})}"
                                               th:text="${post.getTitle()}">
                                                Post Title
                                            </a>
                                        </h3>
                                        <ul class="card-meta my-3 list-inline d-inline-flex align-items-center">
                                            <li class="list-inline-item">
                                                <a href="#" th:href="@{/users/{username}/posts(username=${post.createdBy})}" class="card-meta-author">
                                                    <span th:text="${post.getCreatedBy()}">Author Name</span>
                                                </a>
                                            </li>
                                            <li class="list-inline-item" th:text="${post.getCreatedAt()}">
                                                <div class="tags-container">
                                                    <i class="bi bi-clock"></i>
                                                    <p>Date and time</p>
                                                </div>
                                            </li>
                                            <li class="list-inline-item">
                                                <div class="tags-container">
                                                    <i class="bi bi-chat-dots"></i>
                                                    <p th:text="${post.getComments().size()}">Cnt comments</p>
                                                </div>
                                            </li>
                                            <li class="list-inline-item">
                                                <div class="tags-container">
                                                    <i class="bi bi-tags"></i>
                                                    <p th:each="tag, iterStat : ${post.getTags()}"
                                                       th:if="${iterStat.count <= 3}" th:text="${tag.name}">
                                                        Tag
                                                    </p>
                                                    <p th:if="${post.getTags().size() > 3}">...</p>
                                                </div>
                                            </li>
                                        </ul>

                                        <p class="post-content"
                                           th:text="${post.getContent()}">
                                            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ipsa non officiis
                                            sed
                                            tempora tempore. Alias consequuntur eveniet fugiat laudantium molestias
                                            nihil
                                            officiis sequi similique suscipit voluptatibus! Accusamus accusantium
                                            aliquid
                                            animi,
                                            dignissimos doloremque dolorum enim esse facilis ipsum magnam modi neque
                                            nesciunt
                                            odio quas sapiente similique voluptates voluptatibus. Ab adipisci architecto
                                            assumenda cumque doloribus et eum facilis fuga, hic impedit inventore nam
                                            necessitatibus nihil nostrum officia officiis omnis perferendis perspiciatis
                                            porro
                                            possimus quae qui quibusdam quisquam reiciendis saepe soluta totam velit
                                            vitae
                                            voluptate voluptatum. Dignissimos dolorem laborum voluptatem? Eos fugit
                                            officia
                                            omnis sit voluptatibus. Blanditiis commodi dolorum esse laboriosam, maxime
                                            molestiae
                                            molestias necessitatibus neque nostrum numquam quae repellat reprehenderit
                                            rerum,
                                            similique soluta ut veritatis vero voluptatum. Animi cumque dolore dolorum
                                            earum
                                            explicabo fugiat laudantium optio pariatur quis quo. A ab accusantium alias
                                            asperiores aspernatur assumenda distinctio dolor dolorem doloremque ea error
                                            expedita, facere facilis iste, laudantium maxime nam nobis nostrum nulla
                                            quasi
                                            quod
                                            quos rem voluptas. Ad, alias aliquam at beatae commodi dolor doloremque
                                            ducimus
                                            eaque ex excepturi exercitationem facilis hic libero magnam molestiae nisi
                                            numquam
                                            obcaecati officiis perspiciatis provident quibusdam ratione repellendus sint
                                            soluta
                                            veniam. Assumenda consectetur debitis enim eveniet, fugiat perspiciatis
                                            quisquam?
                                        </p>
                                        <a href="#"
                                           th:href="@{/posts/__${post.postId}__}"
                                           class="btn custom-btn mt-3 mt-lg-4">
                                            Read More
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="pagination"></div>
                </div>
            </div>
        </div>
    </section>


</main>

<!-- Footer Start -->
<div th:replace="~{fragments/ForumSystemForm :: footer}"></div>
<!-- Footer End -->

<!-- JAVASCRIPT FILES -->
<script src="../static/js/jquery.min.js"></script>
<script src="../static/js/bootstrap.bundle.min.js"></script>
<script src="../static/js/jquery.sticky.js"></script>
<script src="../static/js/custom.js"></script>
<script>
    function truncatePosts() {

        var posts = document.querySelectorAll('.post-content');

        posts.forEach(function (post) {
            var content = post.textContent;
            if (content.length > 290) {
                post.textContent = content.substring(0, 290) + '...';
            }
        });
    }

    window.onload = truncatePosts;
</script>
<script>
    const commentsPerPage = 10;
    let currentPage = 1;

    function paginateComments(pageNumber) {
        const comments = document.querySelectorAll('#postsContainer .post');
        const totalPages = Math.ceil(comments.length / commentsPerPage);

        // Hide all comments
        comments.forEach(comment => {
            comment.style.display = 'none';
        });

        // Calculate and show comments for the current page
        const start = (pageNumber - 1) * commentsPerPage;
        const end = start + commentsPerPage;
        for (let i = start; i < end && i < comments.length; i++) {
            comments[i].style.display = 'block';
        }

        // Update the pagination
        updatePagination(totalPages, pageNumber);
    }

    function updatePagination(totalPages, currentPage) {
        const paginationContainer = document.getElementById('pagination');
        let paginationHTML = '';

        // Add previous button
        if (currentPage > 1) {
            paginationHTML += `<a href="#" onclick="paginateComments(${currentPage - 1}); return false;">Previous</a> `;
        }

        let startPage = 1;
        let endPage = totalPages;

        if (totalPages > 10) {
            // More than 10 total pages so calculate start and end pages
            if (currentPage <= 6) {
                startPage = 1;
                endPage = 10;
                paginationHTML += '... ';
            } else if (currentPage + 4 >= totalPages) {
                startPage = totalPages - 9;
                endPage = totalPages;
            } else {
                startPage = currentPage - 5;
                endPage = currentPage + 4;
                paginationHTML += '... ';
            }
        }

        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `<a href="#" ${currentPage === i ? 'class="current-page"' : ''} onclick="paginateComments(${i}); return false;">${i}</a> `;
        }

        // Add next button
        if (currentPage < totalPages) {
            paginationHTML += `<a href="#" onclick="paginateComments(${currentPage + 1}); return false;">Next</a> `;
        }

        paginationContainer.innerHTML = paginationHTML;
    }

    // Initial call to paginate comments
    paginateComments(currentPage);
</script>

</body>
</html>